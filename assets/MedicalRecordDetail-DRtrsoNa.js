import{K as f,a as w,b as v,j as e,A as i,C as x,g as m,B as d,c as C,e as D,s as u,d as k,U as R,m as n}from"./index-Cpz04TgT.js";import{u as B}from"./useQuery-DTgQMnI9.js";import{S as M}from"./skeleton-FVS8MqyW.js";import{P}from"./paperclip-6MeXOYx6.js";import{D as h}from"./download-IdJyy1_l.js";import{f as E}from"./format-BLBLR528.js";const A={lab_result:{label:"Lab Result",color:"text-info"},imaging:{label:"Imaging",color:"text-primary"},visit_note:{label:"Visit Note",color:"text-neutral-blue-gray"},prescription:{label:"Prescription",color:"text-wellness"},immunization:{label:"Immunization",color:"text-success"},procedure_note:{label:"Procedure",color:"text-warning"},discharge_summary:{label:"Discharge Summary",color:"text-primary"}};function S(){const{id:r}=f(),p=w(),{toast:c}=v(),{data:a,isLoading:j,error:b}=B({queryKey:["medical-record",r],queryFn:async()=>{if(!r)throw new Error("Medical record ID is required");const s=await n.getById(r);return n.markAsRead(r).catch(()=>{}),s},enabled:!!r}),g=async()=>{if(r)try{const s=await n.download(r),l=window.URL.createObjectURL(s),t=document.createElement("a");t.href=l,t.download=`medical-record-${r}.pdf`,document.body.appendChild(t),t.click(),window.URL.revokeObjectURL(l),document.body.removeChild(t),c({title:"Download started",description:"Your medical record is being downloaded.",variant:"success"})}catch{c({title:"Download failed",description:"Failed to download medical record. Please try again.",variant:"destructive"})}},y=(s,l)=>{const t=document.createElement("a");t.href=s,t.download=l,t.target="_blank",document.body.appendChild(t),t.click(),document.body.removeChild(t),c({title:"Download started",description:`Downloading ${l}`,variant:"success"})};if(j)return e.jsxs("div",{className:"h-screen flex flex-col bg-neutral-light",children:[e.jsx(i,{title:"Medical Record",showBackButton:!0,backPath:"/patient/medical-records"}),e.jsx("div",{className:"flex-1 overflow-auto",children:e.jsx("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsx(M,{className:"h-96"})})})]});if(b||!a)return e.jsxs("div",{className:"h-screen flex flex-col bg-neutral-light",children:[e.jsx(i,{title:"Medical Record",showBackButton:!0,backPath:"/patient/medical-records"}),e.jsx("div",{className:"flex-1 overflow-auto flex items-center justify-center",children:e.jsx(x,{className:"max-w-md",children:e.jsxs(m,{className:"p-12 text-center",children:[e.jsx("p",{className:"text-error mb-4",children:"Failed to load medical record details."}),e.jsx(d,{onClick:()=>p("/patient/medical-records"),children:"Back to Medical Records"})]})})})]});const N=new Date(a.date),o=A[a.type];return e.jsxs("div",{className:"h-screen flex flex-col bg-neutral-light",children:[e.jsx(i,{title:"Medical Record",showBackButton:!0,backPath:"/patient/medical-records"}),e.jsx("div",{className:"flex-1 overflow-auto",children:e.jsx("div",{className:"bg-white border-b border-neutral-blue-gray/10",children:e.jsx("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:e.jsx("div",{children:e.jsx("h1",{className:"text-h1 text-neutral-blue-gray",children:"Medical Record"})})})})}),e.jsx("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsxs(x,{children:[e.jsx(C,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(D,{className:"text-h2",children:a.title}),a.isNew&&e.jsx(u,{variant:"info",className:"text-xs",children:"New"})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-neutral-blue-gray/70",children:[e.jsx("span",{className:o.color,children:o.label}),e.jsx("span",{children:"â€¢"}),e.jsx("span",{children:a.category})]})]}),e.jsx(u,{variant:a.status==="final"?"success":a.status==="preliminary"?"warning":"secondary",children:a.status.charAt(0).toUpperCase()+a.status.slice(1)})]})}),e.jsxs(m,{className:"space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(k,{className:"h-5 w-5 text-neutral-blue-gray/70 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-neutral-blue-gray/70",children:"Date"}),e.jsx("p",{className:"text-base text-neutral-blue-gray",children:E(N,"EEEE, MMMM d, yyyy")})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(R,{className:"h-5 w-5 text-neutral-blue-gray/70 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-neutral-blue-gray/70",children:"Provider"}),e.jsxs("p",{className:"text-base text-neutral-blue-gray",children:["Dr. ",a.provider]})]})]})]})}),a.summary&&e.jsxs("div",{className:"pt-4 border-t",children:[e.jsx("h3",{className:"text-h4 text-neutral-blue-gray mb-2",children:"Summary"}),e.jsx("p",{className:"text-base text-neutral-blue-gray/80 whitespace-pre-wrap",children:a.summary})]}),a.content&&e.jsxs("div",{className:"pt-4 border-t",children:[e.jsx("h3",{className:"text-h4 text-neutral-blue-gray mb-2",children:"Details"}),e.jsx("div",{className:"text-base text-neutral-blue-gray/80 whitespace-pre-wrap",children:a.content})]}),a.attachments&&a.attachments.length>0&&e.jsxs("div",{className:"pt-4 border-t",children:[e.jsx("h3",{className:"text-h4 text-neutral-blue-gray mb-3",children:"Attachments"}),e.jsx("div",{className:"space-y-2",children:a.attachments.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-neutral-light rounded-lg border border-neutral-blue-gray/10",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(P,{className:"h-4 w-4 text-neutral-blue-gray/70"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-neutral-blue-gray",children:s.name}),e.jsxs("p",{className:"text-xs text-neutral-blue-gray/60",children:[(s.size/1024).toFixed(0)," KB"]})]})]}),e.jsx(d,{size:"sm",variant:"ghost",onClick:()=>y(s.url,s.name),children:e.jsx(h,{className:"h-4 w-4"})})]},s.id))})]}),e.jsx("div",{className:"flex flex-wrap gap-3 pt-4 border-t",children:e.jsxs(d,{onClick:g,children:[e.jsx(h,{className:"h-4 w-4 mr-2"}),"Download Record"]})})]})]})})]})}export{S as default};
