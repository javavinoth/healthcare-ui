import{t as D,v as A,w as c,x as U,_,y as $,z as M,j as e,C as S,g as P,L as g,I as B,l as E,n as L,o as T,p as F,q as f,B as v,X as W,s as G,D as H,c as Q,e as Y,f as J,i as X,a as Z,b as ee,E as se,r as k,G as ae,A as te,H as le,k as I,J as ie}from"./index-BCzS7ZUT.js";import{u as O}from"./useQuery-BEZ1twdU.js";import{S as V}from"./skeleton-D_UUF4rd.js";import{S as re}from"./search-C7g3db3w.js";import{A as ne,a as ce,b as oe}from"./avatar-tXxi9PAK.js";import{M as de}from"./map-pin-B4TseRri.js";import{f as me}from"./format-BLBLR528.js";import{E as he}from"./EmptyState-Bu1xVqMF.js";/**
 * @license lucide-react v0.546.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=[["path",{d:"m5 8 6 6",key:"1wu5hv"}],["path",{d:"m4 14 6-6 2-3",key:"1k1g8d"}],["path",{d:"M2 5h12",key:"or177f"}],["path",{d:"M7 2h1",key:"1t2jsx"}],["path",{d:"m22 22-5-10-5 10",key:"don7ne"}],["path",{d:"M14 18h6",key:"1m8k6r"}]],pe=D("languages",xe);/**
 * @license lucide-react v0.546.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],ge=D("star",ue),je=A({specialty:c().optional(),location:c().optional(),acceptingNewPatients:U().optional(),search:c().optional()}),ye=A({providerId:c().min(1,"Please select a provider"),date:c().min(1,"Please select a date"),time:c().min(1,"Please select a time slot"),type:_(["ROUTINE_CHECKUP","FOLLOW_UP","CONSULTATION","URGENT_CARE","PROCEDURE","LAB_WORK","VACCINATION","TELEHEALTH"]).refine(s=>s!==void 0,{message:"Please select an appointment type"}),reason:c().min(10,"Please provide a reason (at least 10 characters)").max(500,"Reason is too long (maximum 500 characters)").trim(),isVirtual:U().optional(),notes:c().max(1e3,"Notes are too long (maximum 1000 characters)").optional()});A({newDate:c().min(1,"Please select a new date"),newTime:c().min(1,"Please select a new time slot"),reason:c().min(5,"Please provide a reason for rescheduling (at least 5 characters)").max(500,"Reason is too long (maximum 500 characters)").trim().optional()});A({reason:c().min(10,"Please provide a reason for cancellation (at least 10 characters)").max(500,"Reason is too long (maximum 500 characters)").trim()});A({status:_(["all","scheduled","confirmed","checked_in","in_progress","completed","cancelled","no_show"]).optional().default("all"),startDate:c().optional(),endDate:c().optional(),providerId:c().optional(),type:c().optional()});const Ne=["Cardiology","Dermatology","Family Medicine","Internal Medicine","Neurology","Obstetrics & Gynecology","Oncology","Ophthalmology","Orthopedics","Pediatrics","Psychiatry","Radiology","Surgery","Urology"];function fe({onSearch:s,onReset:j,isLoading:h=!1}){const{register:a,handleSubmit:x,setValue:o,watch:u,reset:t,formState:{errors:d}}=$({resolver:M(je),defaultValues:{specialty:"all",location:"",acceptingNewPatients:void 0,search:""}}),p=u("specialty"),m=u("acceptingNewPatients"),N=()=>{t(),j?.()},r=l=>{const b={...l,specialty:l.specialty==="all"?void 0:l.specialty,location:l.location?.trim()||void 0};s(b)};return e.jsx(S,{children:e.jsx(P,{className:"p-6",children:e.jsxs("form",{onSubmit:x(r),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"search",children:"Provider Name"}),e.jsx(B,{id:"search",placeholder:"Search by name...",...a("search"),className:d.search?"border-error":""}),d.search&&e.jsx("p",{className:"text-sm text-error",children:d.search.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"specialty",children:"Specialty"}),e.jsxs(E,{value:p,onValueChange:l=>o("specialty",l),children:[e.jsx(L,{id:"specialty",children:e.jsx(T,{placeholder:"All specialties"})}),e.jsxs(F,{children:[e.jsx(f,{value:"all",children:"All specialties"}),Ne.map(l=>e.jsx(f,{value:l.toLowerCase(),children:l},l))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"location",children:"Location"}),e.jsx(B,{id:"location",placeholder:"City or ZIP code",...a("location")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"acceptingNewPatients",children:"Availability"}),e.jsxs(E,{value:m===void 0?"all":m.toString(),onValueChange:l=>o("acceptingNewPatients",l==="all"?void 0:l==="true"),children:[e.jsx(L,{id:"acceptingNewPatients",children:e.jsx(T,{placeholder:"All providers"})}),e.jsxs(F,{children:[e.jsx(f,{value:"all",children:"All providers"}),e.jsx(f,{value:"true",children:"Accepting new patients"}),e.jsx(f,{value:"false",children:"Not accepting new patients"})]})]})]})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsxs(v,{type:"button",variant:"outline",onClick:N,disabled:h,children:[e.jsx(W,{className:"h-4 w-4 mr-1"}),"Reset"]}),e.jsxs(v,{type:"submit",disabled:h,children:[e.jsx(re,{className:"h-4 w-4 mr-1"}),h?"Searching...":"Search Providers"]})]})]})})})}function ve({provider:s,onSelect:j,selected:h=!1,showSelectButton:a=!0}){const x=`${s.firstName.charAt(0)}${s.lastName.charAt(0)}`,o="photoUrl"in s?s.photoUrl:"avatar"in s?s.avatar:void 0,u="npi"in s?s.npi:"npiNumber"in s?s.npiNumber:void 0,t="title"in s?s.title:void 0,d="rating"in s?s.rating:void 0,p="reviewCount"in s?s.reviewCount:void 0,m="location"in s?s.location:void 0;return e.jsx(S,{className:`hover:shadow-md transition-shadow ${h?"ring-2 ring-primary":""}`,children:e.jsx(P,{className:"p-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsxs(ne,{className:"h-16 w-16",children:[e.jsx(ce,{src:o,alt:`${t||"Dr."} ${s.lastName}`}),e.jsx(oe,{className:"text-lg",children:x})]}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-lg text-neutral-blue-gray",children:[t||"Dr."," ",s.firstName," ",s.lastName]}),s.specialty&&e.jsx("p",{className:"text-sm text-neutral-blue-gray/70",children:s.specialty}),d!==void 0&&e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[e.jsx(ge,{className:"h-4 w-4 fill-warning text-warning"}),e.jsx("span",{className:"text-sm font-medium",children:d.toFixed(1)}),p!==void 0&&e.jsxs("span",{className:"text-sm text-neutral-blue-gray/70",children:["(",p," reviews)"]})]})]}),s.acceptingNewPatients&&e.jsxs(G,{variant:"success",className:"ml-2",children:[e.jsx(H,{className:"h-3 w-3 mr-1"}),"Accepting Patients"]})]}),e.jsxs("div",{className:"space-y-1 text-sm text-neutral-blue-gray/80",children:[m&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{className:"h-4 w-4"}),e.jsxs("span",{children:[m.city,", ",m.state," ",m.zipCode]})]}),s.languages&&s.languages.length>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"h-4 w-4"}),e.jsx("span",{children:s.languages.join(", ")})]}),u&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:"NPI:"}),e.jsx("span",{children:u})]})]}),s.bio&&e.jsx("p",{className:"text-sm text-neutral-blue-gray/70 line-clamp-2 pt-1",children:s.bio}),a&&j&&e.jsx("div",{className:"pt-2",children:e.jsx(v,{size:"sm",onClick:()=>j(s.id),variant:h?"default":"outline",children:h?"Selected":"Select Provider"})})]})]})})})}const be=[{value:"ROUTINE_CHECKUP",label:"Routine Checkup",description:"Annual physical or wellness visit"},{value:"FOLLOW_UP",label:"Follow-up",description:"Follow-up from previous visit"},{value:"CONSULTATION",label:"Consultation",description:"New patient consultation"},{value:"URGENT_CARE",label:"Urgent Care",description:"Non-emergency urgent care"},{value:"PROCEDURE",label:"Procedure",description:"Medical procedure"},{value:"LAB_WORK",label:"Lab Work",description:"Laboratory tests"},{value:"VACCINATION",label:"Vaccination",description:"Immunization or vaccination"},{value:"TELEHEALTH",label:"Telehealth",description:"Virtual video consultation"}];function we({providerId:s,providerName:j,availableSlots:h,onSubmit:a,onCancel:x,isLoading:o=!1,isLoadingSlots:u=!1,onDateChange:t}){const{register:d,handleSubmit:p,setValue:m,watch:N,formState:{errors:r,isSubmitting:l}}=$({resolver:M(ye),defaultValues:{providerId:s,date:"",time:"",reason:"",isVirtual:!1,notes:""}}),b=N("type"),R=N("date"),C=N("time"),y=p(i=>{a({...i,isVirtual:i.isVirtual??!1})});return e.jsxs(S,{children:[e.jsxs(Q,{children:[e.jsx(Y,{children:"Book Appointment"}),e.jsxs(J,{children:["with Dr. ",j]})]}),e.jsx(P,{children:e.jsxs("form",{onSubmit:y,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(g,{htmlFor:"type",children:["Appointment Type ",e.jsx("span",{className:"text-error",children:"*"})]}),e.jsxs(E,{value:b,onValueChange:i=>{m("type",i),i==="TELEHEALTH"&&m("isVirtual",!0)},children:[e.jsx(L,{id:"type",className:r.type?"border-error":"",children:e.jsx(T,{placeholder:"Select appointment type"})}),e.jsx(F,{children:be.map(i=>e.jsx(f,{value:i.value,children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:i.label}),e.jsx("div",{className:"text-xs text-neutral-blue-gray/70",children:i.description})]})},i.value))})]}),r.type&&e.jsx("p",{className:"text-sm text-error",children:r.type.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(g,{htmlFor:"date",children:["Preferred Date ",e.jsx("span",{className:"text-error",children:"*"})]}),e.jsx(B,{id:"date",type:"date",min:me(new Date,"yyyy-MM-dd"),...d("date",{onChange:i=>{t&&t(i.target.value)}}),className:r.date?"border-error":""}),r.date&&e.jsx("p",{className:"text-sm text-error",children:r.date.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(g,{htmlFor:"time",children:["Time Slot ",e.jsx("span",{className:"text-error",children:"*"})]}),u?e.jsx("div",{className:"text-sm text-neutral-blue-gray/70 p-3 border rounded-md bg-neutral-light",children:"Loading available time slots..."}):h.length>0?e.jsxs(E,{value:C,onValueChange:i=>m("time",i),children:[e.jsx(L,{id:"time",className:r.time?"border-error":"",children:e.jsx(T,{placeholder:"Select a time slot"})}),e.jsx(F,{children:h.map(i=>e.jsx(f,{value:i,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-4 w-4"}),i]})},i))})]}):e.jsx("div",{className:"text-sm text-neutral-blue-gray/70 p-3 border rounded-md bg-neutral-light",children:R?"No available slots for this date. Please select another date.":"Please select a date first to see available time slots."}),r.time&&e.jsx("p",{className:"text-sm text-error",children:r.time.message})]}),b!=="TELEHEALTH"&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:"isVirtual",type:"checkbox",...d("isVirtual"),className:"h-4 w-4 rounded border-neutral-blue-gray/30 text-primary focus:ring-2 focus:ring-primary focus:ring-offset-2"}),e.jsx(g,{htmlFor:"isVirtual",className:"cursor-pointer font-normal",children:"Request virtual appointment (if available)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(g,{htmlFor:"reason",children:["Reason for Visit ",e.jsx("span",{className:"text-error",children:"*"})]}),e.jsx("textarea",{id:"reason",rows:3,placeholder:"Please describe the reason for your appointment...",...d("reason"),className:`w-full rounded-md border ${r.reason?"border-error":"border-neutral-blue-gray/30"} px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2`}),r.reason&&e.jsx("p",{className:"text-sm text-error",children:r.reason.message}),e.jsx("p",{className:"text-xs text-neutral-blue-gray/60",children:"Minimum 10 characters, maximum 500 characters"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"notes",children:"Additional Notes (Optional)"}),e.jsx("textarea",{id:"notes",rows:2,placeholder:"Any additional information for the provider...",...d("notes"),className:"w-full rounded-md border border-neutral-blue-gray/30 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2"}),r.notes&&e.jsx("p",{className:"text-sm text-error",children:r.notes.message})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[x&&e.jsx(v,{type:"button",variant:"outline",onClick:x,disabled:o||l,className:"flex-1",children:"Cancel"}),e.jsx(v,{type:"submit",disabled:o||l,className:"flex-1",children:o||l?"Booking...":"Book Appointment"})]})]})})]})}function Fe(){const s=Z(),{toast:j}=ee(),h=se(),[a,x]=k.useState("search"),[o,u]=k.useState({}),[t,d]=k.useState(null),[p,m]=k.useState(""),{data:N,isLoading:r,error:l}=O({queryKey:["providers",o],queryFn:async()=>{console.log("[Provider Search] Fetching with params:",o);const n=await ie.getAll({search:o.search,specialty:o.specialty,location:o.location,acceptingNewPatients:o.acceptingNewPatients});console.log("[Provider Search] Raw response:",n);const w=n||[];return console.log("[Provider Search] Parsed data:",w,"Count:",w.length),w},enabled:a==="select"}),{data:b,isLoading:R}=O({queryKey:["availableSlots",t?.id,p],queryFn:async()=>!t?.id||!p?{slots:[]}:await I.getAvailableSlots(t.id,p),enabled:a==="book"&&!!t?.id&&!!p,staleTime:0}),C=ae({mutationFn:I.create,onSuccess:()=>{h.invalidateQueries({queryKey:["appointments"]}),x("success"),j({title:"Appointment booked!",description:"Your appointment has been successfully scheduled.",variant:"success"})},onError:n=>{j({title:"Booking failed",description:n.response?.data?.message||"Failed to book appointment. Please try again.",variant:"destructive"})}}),y=N||[];console.log("[Provider Search] State - step:",a,"loading:",r,"error:",l,"providers:",y,"count:",y.length);const i=n=>{console.log("[Provider Search] handleSearch called with:",n),u(n),x("select")},q=n=>{const w=y.find(z=>z.id===n);w&&(d(w),x("book"))},K=async n=>{t&&await C.mutateAsync({...n,providerId:t.id,providerName:`${t.firstName} ${t.lastName}`,patientId:"",patientName:"",status:"scheduled"})};return e.jsxs("div",{className:"h-screen flex flex-col bg-neutral-light",children:[e.jsx(te,{title:"Book Appointment",showBackButton:a!=="success",backPath:"/patient/appointments"}),e.jsxs("div",{className:"flex-1 overflow-auto",children:[e.jsx("div",{className:"bg-white border-b border-neutral-blue-gray/10",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-h1 text-neutral-blue-gray",children:"Book Appointment"}),e.jsxs("p",{className:"text-body text-neutral-blue-gray/70 mt-1",children:[a==="search"&&"Search for a healthcare provider",a==="select"&&"Select a provider",a==="book"&&"Choose your appointment details",a==="success"&&"Appointment confirmed"]})]})})}),e.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[a!=="success"&&e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:`flex items-center gap-2 ${a==="search"?"text-primary":"text-neutral-blue-gray/50"}`,children:[e.jsx("div",{className:`flex h-8 w-8 items-center justify-center rounded-full ${a==="search"?"bg-primary text-white":"bg-neutral-blue-gray/20"}`,children:"1"}),e.jsx("span",{className:"text-sm font-medium",children:"Search"})]}),e.jsx("div",{className:"flex-1 h-px bg-neutral-blue-gray/20 mx-4"}),e.jsxs("div",{className:`flex items-center gap-2 ${a==="select"?"text-primary":"text-neutral-blue-gray/50"}`,children:[e.jsx("div",{className:`flex h-8 w-8 items-center justify-center rounded-full ${a==="select"?"bg-primary text-white":"bg-neutral-blue-gray/20"}`,children:"2"}),e.jsx("span",{className:"text-sm font-medium",children:"Select Provider"})]}),e.jsx("div",{className:"flex-1 h-px bg-neutral-blue-gray/20 mx-4"}),e.jsxs("div",{className:`flex items-center gap-2 ${a==="book"?"text-primary":"text-neutral-blue-gray/50"}`,children:[e.jsx("div",{className:`flex h-8 w-8 items-center justify-center rounded-full ${a==="book"?"bg-primary text-white":"bg-neutral-blue-gray/20"}`,children:"3"}),e.jsx("span",{className:"text-sm font-medium",children:"Book"})]})]})}),a==="search"&&e.jsx(fe,{onSearch:i,onReset:()=>u({})}),a==="select"&&e.jsx("div",{className:"space-y-4",children:r?e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"h-48"}),e.jsx(V,{className:"h-48"}),e.jsx(V,{className:"h-48"})]}):l?e.jsx(S,{children:e.jsx(P,{className:"p-12",children:e.jsx("p",{className:"text-error text-center",children:"Failed to load providers. Please try again."})})}):y.length===0?e.jsx(he,{icon:le,title:"No providers found",description:"No providers match your search criteria. Try adjusting your filters.",actionLabel:"Back to Search",onAction:()=>x("search")}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("p",{className:"text-sm text-neutral-blue-gray/70",children:["Found ",y.length," provider",y.length!==1?"s":""]})}),y.map(n=>e.jsx(ve,{provider:n,onSelect:q,showSelectButton:!0},n.id))]})}),a==="book"&&t&&e.jsx(we,{providerId:t.id,providerName:`${t.firstName} ${t.lastName}`,availableSlots:b?.slots||[],onSubmit:K,onCancel:()=>x("select"),isLoading:C.isPending,isLoadingSlots:R,onDateChange:n=>m(n)}),a==="success"&&e.jsx(S,{children:e.jsx(P,{className:"p-12",children:e.jsxs("div",{className:"text-center space-y-6",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"flex h-20 w-20 items-center justify-center rounded-full bg-wellness/10",children:e.jsx(H,{className:"h-12 w-12 text-wellness"})})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-h2 text-neutral-blue-gray mb-2",children:"Appointment Confirmed!"}),e.jsx("p",{className:"text-neutral-blue-gray/70",children:"Your appointment has been successfully booked. You will receive a confirmation email shortly."})]}),e.jsxs("div",{className:"flex gap-4 justify-center",children:[e.jsx(v,{onClick:()=>s("/patient/appointments"),children:"View Appointments"}),e.jsx(v,{variant:"outline",onClick:()=>s("/patient/dashboard"),children:"Back to Dashboard"})]})]})})})]})]})]})}export{Fe as default};
