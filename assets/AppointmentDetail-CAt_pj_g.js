import{K as G,a as X,b as W,E as Z,r,G as b,j as e,A as h,C as w,g as C,B as l,c as ee,e as se,s as te,d as ae,i as ne,U as ie,F as D,X as le,N as k,O as A,P as R,Q as S,R as T,L as g,I as M,k as j}from"./index-92FsJMKL.js";import{u as re}from"./useQuery-BtA2DJKW.js";import{S as ce}from"./skeleton-DmCllHn_.js";import{V as P}from"./video-DqVqpylD.js";import{M as oe}from"./map-pin-CAq1tErm.js";import{S as de}from"./square-pen-BzIR14hF.js";import{T as me}from"./triangle-alert-OTx_utNl.js";import{f as q}from"./format-BLBLR528.js";const ue={scheduled:{variant:"default",label:"Scheduled"},confirmed:{variant:"success",label:"Confirmed"},checked_in:{variant:"info",label:"Checked In"},in_progress:{variant:"warning",label:"In Progress"},completed:{variant:"secondary",label:"Completed"},cancelled:{variant:"destructive",label:"Cancelled"},no_show:{variant:"destructive",label:"No Show"}};function be(){const{id:n}=G(),f=X(),{toast:i}=W(),c=Z(),[E,o]=r.useState(!1),[B,d]=r.useState(!1),[m,F]=r.useState(""),[u,L]=r.useState(""),[a,V]=r.useState(""),{data:s,isLoading:I,error:K}=re({queryKey:["appointment",n],queryFn:async()=>{if(!n)throw new Error("Appointment ID is required");return await j.getById(n)},enabled:!!n}),Q=t=>{const[N,U]=t.split(":").map(Number),z=N>=12?"PM":"AM";return`${N%12||12}:${U.toString().padStart(2,"0")} ${z}`},x=b({mutationFn:async()=>{if(!n||!m||!u)throw new Error("Missing required fields");const t=Q(u);return j.reschedule(n,m,t)},onSuccess:()=>{c.invalidateQueries({queryKey:["appointments"]}),c.invalidateQueries({queryKey:["appointment",n]}),o(!1),i({title:"Appointment rescheduled",description:"Your appointment has been successfully rescheduled.",variant:"success"})},onError:t=>{i({title:"Reschedule failed",description:t.response?.data?.message||"Failed to reschedule appointment.",variant:"destructive"})}}),p=b({mutationFn:async()=>{if(!n)throw new Error("Appointment ID is required");return j.cancel(n,a)},onSuccess:()=>{c.invalidateQueries({queryKey:["appointments"]}),c.invalidateQueries({queryKey:["appointment",n]}),d(!1),i({title:"Appointment cancelled",description:"Your appointment has been cancelled.",variant:"success"}),f("/patient/appointments")},onError:t=>{i({title:"Cancellation failed",description:t.response?.data?.message||"Failed to cancel appointment.",variant:"destructive"})}}),_=()=>{x.mutate()},$=()=>{const t=a.trim();if(!t){i({title:"Reason required",description:"Please provide a reason for cancellation.",variant:"warning"});return}if(t.length<10){i({title:"Reason too short",description:"Cancellation reason must be at least 10 characters.",variant:"warning"});return}if(t.length>500){i({title:"Reason too long",description:"Cancellation reason cannot exceed 500 characters.",variant:"warning"});return}p.mutate()},H=()=>{s?.videoLink&&(window.open(s.videoLink,"_blank","noopener,noreferrer"),i({title:"Opening video call",description:"Your virtual appointment is opening in a new window.",variant:"success"}))};if(I)return e.jsxs("div",{className:"h-screen flex flex-col bg-neutral-light",children:[e.jsx(h,{title:"Appointment Details",showBackButton:!0,backPath:"/patient/appointments"}),e.jsx("div",{className:"flex-1 overflow-auto",children:e.jsx("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsx(ce,{className:"h-96"})})})]});if(K||!s)return e.jsxs("div",{className:"h-screen flex flex-col bg-neutral-light",children:[e.jsx(h,{title:"Appointment Details",showBackButton:!0,backPath:"/patient/appointments"}),e.jsx("div",{className:"flex-1 overflow-auto flex items-center justify-center",children:e.jsx(w,{className:"max-w-md",children:e.jsxs(C,{className:"p-12 text-center",children:[e.jsx("p",{className:"text-error mb-4",children:"Failed to load appointment details."}),e.jsx(l,{onClick:()=>f("/patient/appointments"),children:"Back to Appointments"})]})})})]});const O=new Date(s.date),v=ue[s.status],y=s.status==="scheduled"||s.status==="confirmed",J=s.status==="scheduled"||s.status==="confirmed",Y=s.isVirtual&&s.videoLink&&y;return e.jsxs("div",{className:"h-screen flex flex-col bg-neutral-light",children:[e.jsx(h,{title:"Appointment Details",showBackButton:!0,backPath:"/patient/appointments"}),e.jsx("div",{className:"flex-1 overflow-auto",children:e.jsx("div",{className:"bg-white border-b border-neutral-blue-gray/10",children:e.jsx("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:e.jsx("div",{children:e.jsx("h1",{className:"text-h1 text-neutral-blue-gray",children:"Appointment Details"})})})})}),e.jsx("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsxs(w,{children:[e.jsx(ee,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs(se,{className:"text-h2",children:["Appointment with Dr. ",s.providerName]}),s.providerSpecialty&&e.jsx("p",{className:"text-sm text-neutral-blue-gray/70 mt-1",children:s.providerSpecialty})]}),e.jsx(te,{variant:v.variant,children:v.label})]})}),e.jsxs(C,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ae,{className:"h-5 w-5 text-neutral-blue-gray/70 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-neutral-blue-gray/70",children:"Date"}),e.jsx("p",{className:"text-base text-neutral-blue-gray",children:q(O,"EEEE, MMMM d, yyyy")})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ne,{className:"h-5 w-5 text-neutral-blue-gray/70 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-neutral-blue-gray/70",children:"Time"}),e.jsxs("p",{className:"text-base text-neutral-blue-gray",children:[s.startTime," - ",s.endTime]})]})]}),s.isVirtual?e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(P,{className:"h-5 w-5 text-info mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-neutral-blue-gray/70",children:"Type"}),e.jsx("p",{className:"text-base text-info",children:"Virtual Appointment"})]})]}):s.location?e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(oe,{className:"h-5 w-5 text-neutral-blue-gray/70 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-neutral-blue-gray/70",children:"Location"}),e.jsx("p",{className:"text-base text-neutral-blue-gray",children:s.location})]})]}):null]}),e.jsxs("div",{className:"space-y-4",children:[s.type&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ie,{className:"h-5 w-5 text-neutral-blue-gray/70 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-neutral-blue-gray/70",children:"Appointment Type"}),e.jsx("p",{className:"text-base text-neutral-blue-gray capitalize",children:s.type.toLowerCase().replace("_"," ")})]})]}),s.reason&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(D,{className:"h-5 w-5 text-neutral-blue-gray/70 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-neutral-blue-gray/70",children:"Reason"}),e.jsx("p",{className:"text-base text-neutral-blue-gray",children:s.reason})]})]}),s.notes&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(D,{className:"h-5 w-5 text-neutral-blue-gray/70 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-neutral-blue-gray/70",children:"Notes"}),e.jsx("p",{className:"text-base text-neutral-blue-gray",children:s.notes})]})]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3 pt-4 border-t",children:[Y&&e.jsxs(l,{onClick:H,className:"bg-info hover:bg-info/90",children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),"Join Video Call"]}),y&&e.jsxs(l,{variant:"outline",onClick:()=>o(!0),children:[e.jsx(de,{className:"h-4 w-4 mr-2"}),"Reschedule"]}),J&&e.jsxs(l,{variant:"destructive",onClick:()=>d(!0),children:[e.jsx(le,{className:"h-4 w-4 mr-2"}),"Cancel Appointment"]})]})]})]})}),e.jsx(k,{open:E,onOpenChange:o,children:e.jsxs(A,{children:[e.jsxs(R,{children:[e.jsx(S,{children:"Reschedule Appointment"}),e.jsx(T,{children:"Choose a new date and time for your appointment."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"reschedule-date",children:"New Date"}),e.jsx(M,{id:"reschedule-date",type:"date",min:q(new Date,"yyyy-MM-dd"),value:m,onChange:t=>F(t.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"reschedule-time",children:"New Time"}),e.jsx(M,{id:"reschedule-time",type:"time",value:u,onChange:t=>L(t.target.value)})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(l,{variant:"outline",onClick:()=>o(!1),className:"flex-1",children:"Cancel"}),e.jsx(l,{onClick:_,disabled:!m||!u||x.isPending,className:"flex-1",children:x.isPending?"Rescheduling...":"Confirm"})]})]})}),e.jsx(k,{open:B,onOpenChange:d,children:e.jsxs(A,{children:[e.jsxs(R,{children:[e.jsxs(S,{className:"flex items-center gap-2 text-error",children:[e.jsx(me,{className:"h-5 w-5"}),"Cancel Appointment"]}),e.jsx(T,{children:"Are you sure you want to cancel this appointment? This action cannot be undone."})]}),e.jsx("div",{className:"space-y-4 py-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"cancel-reason",children:"Reason for Cancellation *"}),e.jsx("textarea",{id:"cancel-reason",rows:3,placeholder:"Please provide a reason (minimum 10 characters)...",value:a,onChange:t=>V(t.target.value),maxLength:500,className:`w-full rounded-md border px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-offset-2 ${a.trim().length>0&&a.trim().length<10?"border-error focus:ring-error":"border-neutral-blue-gray/30 focus:ring-primary"}`}),e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:a.trim().length>0&&a.trim().length<10?"text-error":a.trim().length>=10?"text-wellness":"text-neutral-blue-gray/60",children:a.trim().length<10?`Minimum 10 characters (${a.trim().length}/10)`:"Valid reason length"}),e.jsxs("span",{className:"text-neutral-blue-gray/60",children:[a.length,"/500"]})]})]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(l,{variant:"outline",onClick:()=>d(!1),className:"flex-1",children:"Keep Appointment"}),e.jsx(l,{variant:"destructive",onClick:$,disabled:p.isPending||a.trim().length<10||a.trim().length>500,className:"flex-1",children:p.isPending?"Cancelling...":"Cancel Appointment"})]})]})})]})}export{be as default};
